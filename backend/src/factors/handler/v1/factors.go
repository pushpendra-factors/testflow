package v1

import (
	"encoding/json"
	mid "factors/middleware"
	M "factors/model"
	U "factors/util"
	"net/http"

	"github.com/gin-gonic/gin"
)

// Factors Constants
var CAMPAIGNTYPE string = "campaign"
var ATTRIBUTETYPE string = "attribute"
var JOURNEYTYPE string = "journey"

// Factors object
type Factors struct {
	GoalRule              M.FactorsGoalRule `json:"goal"`
	Insights              []FactorsInsights `json:"insights"`
	GoalUserCount         float64           `json:"goal_user_count"`
	TotalUsersCount       float64           `json:"total_users_count"`
	OverallPercentageText string            `json:"overall_percentage_text"`
	OverallPercentage     float64           `json:"overall_percentage"`
	OverallMultiplier     float64           `json:"overall_multiplier"`
	Type                  string            `json:"type"`
}

// FactorsAttributeTuple object
type FactorsAttributeTuple struct {
	FactorsAttributeKey   string `json:"factors_attribute_key"`
	FactorsAttributeValue string `json:"factors_attribute_value"`
}

// FactorsInsights object
type FactorsInsights struct {
	FactorsInsightsAttribute      []FactorsAttributeTuple `json:"factors_insights_attribute"`
	FactorsInsightsKey            string                  `json:"factors_insights_key"`
	FactorsInsightsText           string                  `json:"factors_insights_text"`
	FactorsHigherCompletionText   string                  `json:"factors_higher_completion_text"`
	FactorsLowerCompletionText    string                  `json:"factors_lower_completion_text"`
	FactorsInsightsMultiplier     float64                 `json:"factors_insights_multiplier"`
	FactorsInsightsPercentage     float64                 `json:"factors_insights_percentage"`
	FactorsInsightsUsersCount     float64                 `json:"factors_insights_users_count"`
	FactorsGoalUsersCount         float64                 `json:"factors_goal_users_count"`
	FactorsMultiplierIncreaseFlag bool                    `json:"factors_multiplier_increase_flag"`
	FactorsInsightsType           string                  `json:"factors_insights_type"`
	FactorsSubInsights            []*FactorsInsights      `json:"factors_sub_insights"`
}

// GetAllFactorsHandler - Factors handler
func PostFactorsHandler(c *gin.Context) {
	inputType := c.Query("type")
	var factorsOutput string
	if inputType == "journey" {
		factorsOutput = "{\"goal\":{\"st_en\":\"Demo Scheduled\",\"en_en\":\"Opportunity Created\",\"st_time\":\"2020-10-01T00:00:00Z\",\"en_time\":\"2020-10-31T00:00:00Z\"},\"type\": \"journey\", \"goal_user_count\":534,\"total_users_count\":2651,\"overall_percentage\":20.14,\"overall_multiplier\":1,\"overall_percentage_text\":\"20.14% of all users have completed this goal\",\"insights\":[{\"factors_insights_key\":\"Acme - Customers\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Customers</a> shows 1.6x higher goal completion\",\"factors_insights_multiplier\":1.6,\"factors_insights_percentage\":32.2,\"factors_insights_users_count\":322,\"factors_goal_users_count\":104,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Webinar\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Webinar</a> shows 1.8x higher goal completion\",\"factors_insights_multiplier\":1.8,\"factors_insights_percentage\":36.3,\"factors_insights_users_count\":352,\"factors_goal_users_count\":128,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Competitors\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Competitors</a> shows 1.5x higher goal completion\",\"factors_insights_multiplier\":1.5,\"factors_insights_percentage\":30.2,\"factors_insights_users_count\":490,\"factors_goal_users_count\":148,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"higher completions for Acme - Features +2factors\",\"factors_lower_completion_text\":\"lower completions for Acme - Features\",\"factors_sub_insights\":[{\"factors_insights_key\":\"Acme - Features\",\"factors_insights_text\":\"and then <a>Acme - Features</a> shows 2.1x higher goal completion\",\"factors_insights_multiplier\":2.1,\"factors_insights_percentage\":42.3,\"factors_insights_users_count\":127,\"factors_goal_users_count\":54,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Case Studies\",\"factors_insights_text\":\"and then <a>Acme - Case Studies</a> shows 1.8x higher goal completion\",\"factors_insights_multiplier\":1.8,\"factors_insights_percentage\":36.3,\"factors_insights_users_count\":173,\"factors_goal_users_count\":63,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Thought Leadership\",\"factors_insights_text\":\"and then <a>Acme - Thought Leadership</a> shows 0.6x higher goal completion\",\"factors_insights_multiplier\":0.6,\"factors_insights_percentage\":12.1,\"factors_insights_users_count\":206,\"factors_goal_users_count\":25,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Pricing\",\"factors_insights_text\":\"and then <a>Acme - Pricing</a> shows 1.3x higher goal completion\",\"factors_insights_multiplier\":1.3,\"factors_insights_percentage\":26.2,\"factors_insights_users_count\":156,\"factors_goal_users_count\":41,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"}]},{\"factors_insights_key\":\"Attended Webinar - Champions of Change\",\"factors_insights_text\":\"of which visitors coming via <a>Attended Webinar - Champions of Change</a> shows 1.6x higher goal completion\",\"factors_insights_multiplier\":1.6,\"factors_insights_percentage\":32.2,\"factors_insights_users_count\":133,\"factors_goal_users_count\":43,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Attended Webinar - Masters of Conversion\",\"factors_insights_text\":\"of which visitors coming via <a>Attended Webinar - Masters of Conversion</a> shows 1.9x higher goal completion\",\"factors_insights_multiplier\":1.9,\"factors_insights_percentage\":38.3,\"factors_insights_users_count\":96,\"factors_goal_users_count\":37,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Downloaded Gartner Guide\",\"factors_insights_text\":\"of which visitors coming via <a>Downloaded Gartner Guide</a> shows 0.8x higher goal completion\",\"factors_insights_multiplier\":0.8,\"factors_insights_percentage\":16.1,\"factors_insights_users_count\":192,\"factors_goal_users_count\":31,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Opened Email : Ten Case Studies of Happy Customers\",\"factors_insights_text\":\"of which visitors coming via <a>Opened Email : Ten Case Studies of Happy Customers</a> shows 0.6x higher goal completion\",\"factors_insights_multiplier\":0.6,\"factors_insights_percentage\":12.1,\"factors_insights_users_count\":206,\"factors_goal_users_count\":25,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Subscribed to Newsletter\",\"factors_insights_text\":\"of which visitors coming via <a>Subscribed to Newsletter</a> shows 1.15x higher goal completion\",\"factors_insights_multiplier\":1.15,\"factors_insights_percentage\":23.2,\"factors_insights_users_count\":314,\"factors_goal_users_count\":73,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/documentation\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/documentation</a> shows 1.8x higher goal completion\",\"factors_insights_multiplier\":1.8,\"factors_insights_percentage\":36.3,\"factors_insights_users_count\":88,\"factors_goal_users_count\":32,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/resources\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/resources</a> shows 0.75x higher goal completion\",\"factors_insights_multiplier\":0.75,\"factors_insights_percentage\":15.1,\"factors_insights_users_count\":178,\"factors_goal_users_count\":27,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/compliance\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/compliance</a> shows 0.7x higher goal completion\",\"factors_insights_multiplier\":0.7,\"factors_insights_percentage\":14.1,\"factors_insights_users_count\":198,\"factors_goal_users_count\":28,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/product\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/product</a> shows 1.3x higher goal completion\",\"factors_insights_multiplier\":1.3,\"factors_insights_percentage\":26.2,\"factors_insights_users_count\":202,\"factors_goal_users_count\":53,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Industry\",\"factors_attribute_value\":\" Diversified Financial Services\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Industry= Diversified Financial Services</a> shows 1.4x higher goal completion\",\"factors_insights_multiplier\":1.4,\"factors_insights_percentage\":28.2,\"factors_insights_users_count\":247,\"factors_goal_users_count\":69,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Industry\",\"factors_attribute_value\":\" Health Care Providers & Services\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Industry= Health Care Providers & Services</a> shows 1.8x higher goal completion\",\"factors_insights_multiplier\":1.8,\"factors_insights_percentage\":36.3,\"factors_insights_users_count\":117,\"factors_goal_users_count\":42,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\" <5 mn\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Revenue <5 mn</a> shows 0.6x higher goal completion\",\"factors_insights_multiplier\":0.6,\"factors_insights_percentage\":12.1,\"factors_insights_users_count\":514,\"factors_goal_users_count\":62,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\" 6-15 mn\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Revenue= 6-15 mn</a> shows 1.6x higher goal completion\",\"factors_insights_multiplier\":1.6,\"factors_insights_percentage\":32.2,\"factors_insights_users_count\":442,\"factors_goal_users_count\":142,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\" 50mn+\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Revenue= 50mn+</a> shows 2.7x higher goal completion\",\"factors_insights_multiplier\":2.7,\"factors_insights_percentage\":54.4,\"factors_insights_users_count\":129,\"factors_goal_users_count\":70,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Num_contacts_in_company\",\"factors_attribute_value\":\"6 to 10\"}],\"factors_insights_text\":\"of which visitors with <a>Num_contacts_in_company=6 to 10</a> shows 3.2x higher goal completion\",\"factors_insights_multiplier\":3.2,\"factors_insights_percentage\":64.4,\"factors_insights_users_count\":341,\"factors_goal_users_count\":219,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Num_Sessions\",\"factors_attribute_value\":\" <3\"}],\"factors_insights_text\":\"of which visitors with <a>Num_Sessions <3</a> shows 0.4x higher goal completion\",\"factors_insights_multiplier\":0.4,\"factors_insights_percentage\":8.1,\"factors_insights_users_count\":432,\"factors_goal_users_count\":34,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Industry\",\"factors_attribute_value\":\" Education Services\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Industry= Education Services</a> shows 3.6x higher goal completion\",\"factors_insights_multiplier\":3.6,\"factors_insights_percentage\":72.5,\"factors_insights_users_count\":478,\"factors_goal_users_count\":346,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"}]}"
	} else {
		factorsOutput = "{\"goal\":{\"st_en\":\"All Visitors\",\"en_en\":\"Demo Scheduled\",\"st_time\":\"2020-10-01T00:00:00Z\",\"en_time\":\"2020-10-31T00:00:00Z\"},\"goal_user_count\":2651,\"total_users_count\":124940,\"overall_percentage\":2.12,\"overall_multiplier\":1,\"overall_percentage_text\":\"2.12% of all users have completed this goal\",\"insights\":[{\"factors_insights_key\":\"Acme - Competitors\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Competitors</a> shows 2x higher goal completion\",\"factors_insights_multiplier\":2,\"factors_insights_percentage\":4.2,\"factors_insights_users_count\":2976,\"factors_goal_users_count\":125,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Brand\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Brand</a> shows 1.4x higher goal completion\",\"factors_insights_multiplier\":1.4,\"factors_insights_percentage\":3,\"factors_insights_users_count\":11300,\"factors_goal_users_count\":339,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - High Intent\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - High Intent</a> shows 1.8x higher goal completion\",\"factors_insights_multiplier\":1.8,\"factors_insights_percentage\":3.8,\"factors_insights_users_count\":14921,\"factors_goal_users_count\":567,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"higher completions for Acme - Competitors +2factors\",\"factors_lower_completion_text\":\"lower completions for Acme - Competitors\",\"factors_sub_insights\":[{\"factors_insights_key\":\"Acme - Competitors\",\"factors_insights_text\":\"and then <a>Acme - Competitors</a> shows 2.3x higher goal completion\",\"factors_insights_multiplier\":2.3,\"factors_insights_percentage\":4.9,\"factors_insights_users_count\":918,\"factors_goal_users_count\":45,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Retargeting\",\"factors_insights_text\":\"and then <a>Acme - Retargeting</a> shows 2.1x higher goal completion\",\"factors_insights_multiplier\":2.1,\"factors_insights_percentage\":4.5,\"factors_insights_users_count\":1444,\"factors_goal_users_count\":65,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Lost Prospects\",\"factors_insights_text\":\"and then <a>Acme - Lost Prospects</a> shows 0.6x higher goal completion\",\"factors_insights_multiplier\":0.6,\"factors_insights_percentage\":1.3,\"factors_insights_users_count\":1307,\"factors_goal_users_count\":17,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Features\",\"factors_insights_text\":\"and then <a>Acme - Features</a> shows 2.5x higher goal completion\",\"factors_insights_multiplier\":2.5,\"factors_insights_percentage\":5.3,\"factors_insights_users_count\":2377,\"factors_goal_users_count\":126,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"higher completions for Acme - Brand +3factors\",\"factors_lower_completion_text\":\"\",\"factors_sub_insights\":[{\"factors_insights_key\":\"Acme - Brand\",\"factors_insights_text\":\"and then <a>Acme - Brand</a> shows 4.6x higher goal completion\",\"factors_insights_multiplier\":4.6,\"factors_insights_percentage\":9.8,\"factors_insights_users_count\":346,\"factors_goal_users_count\":34,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Retargeting\",\"factors_insights_text\":\"and then <a>Acme - Retargeting</a> shows 2.8x higher goal completion\",\"factors_insights_multiplier\":2.8,\"factors_insights_percentage\":5.9,\"factors_insights_users_count\":389,\"factors_goal_users_count\":23,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Competitors\",\"factors_insights_text\":\"and then <a>Acme - Competitors</a> shows 3.1x higher goal completion\",\"factors_insights_multiplier\":3.1,\"factors_insights_percentage\":6.6,\"factors_insights_users_count\":409,\"factors_goal_users_count\":27,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Lost Prospects\",\"factors_insights_text\":\"and then <a>Acme - Lost Prospects</a> shows 1.4x higher goal completion\",\"factors_insights_multiplier\":1.4,\"factors_insights_percentage\":3,\"factors_insights_users_count\":400,\"factors_goal_users_count\":12,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"}]},{\"factors_insights_key\":\"Acme - Brand\",\"factors_insights_text\":\"and then <a>Acme - Brand</a> shows 5.7x higher goal completion\",\"factors_insights_multiplier\":5.7,\"factors_insights_percentage\":12.1,\"factors_insights_users_count\":942,\"factors_goal_users_count\":114,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"higher completions for Acme - Features +2factors\",\"factors_lower_completion_text\":\"lower completions for Acme - Features\",\"factors_sub_insights\":[{\"factors_insights_key\":\"Acme - Features\",\"factors_insights_text\":\"and then <a>Acme - Features</a> shows 5.9x higher goal completion\",\"factors_insights_multiplier\":5.9,\"factors_insights_percentage\":12.5,\"factors_insights_users_count\":408,\"factors_goal_users_count\":51,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Retargeting\",\"factors_insights_text\":\"and then <a>Acme - Retargeting</a> shows 2.5x higher goal completion\",\"factors_insights_multiplier\":2.5,\"factors_insights_percentage\":5.3,\"factors_insights_users_count\":509,\"factors_goal_users_count\":27,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Competitors\",\"factors_insights_text\":\"and then <a>Acme - Competitors</a> shows 2.8x higher goal completion\",\"factors_insights_multiplier\":2.8,\"factors_insights_percentage\":5.9,\"factors_insights_users_count\":525,\"factors_goal_users_count\":31,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Lost Prospects\",\"factors_insights_text\":\"and then <a>Acme - Lost Prospects</a> shows 0.8x higher goal completion\",\"factors_insights_multiplier\":0.8,\"factors_insights_percentage\":1.7,\"factors_insights_users_count\":705,\"factors_goal_users_count\":12,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"campaign\"}]}]},{\"factors_insights_key\":\"Acme - Retargeting\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Retargeting</a> shows 1.6x higher goal completion\",\"factors_insights_multiplier\":1.6,\"factors_insights_percentage\":3.4,\"factors_insights_users_count\":6588,\"factors_goal_users_count\":224,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Lost Prospects\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Lost Prospects</a> shows 0.2x higher goal completion\",\"factors_insights_multiplier\":0.2,\"factors_insights_percentage\":0.4,\"factors_insights_users_count\":19500,\"factors_goal_users_count\":78,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Features\",\"factors_insights_text\":\"of which visitors from the campaign <a>Acme - Features</a> shows 1.1x higher goal completion\",\"factors_insights_multiplier\":1.1,\"factors_insights_percentage\":2.3,\"factors_insights_users_count\":20217,\"factors_goal_users_count\":465,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"higher completions for Acme - Retargeting +3factors\",\"factors_lower_completion_text\":\"\",\"factors_sub_insights\":[{\"factors_insights_key\":\"Acme - Retargeting\",\"factors_insights_text\":\"and then <a>Acme - Retargeting</a> shows 1.3x higher goal completion\",\"factors_insights_multiplier\":1.3,\"factors_insights_percentage\":2.8,\"factors_insights_users_count\":2000,\"factors_goal_users_count\":56,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - High Intent\",\"factors_insights_text\":\"and then <a>Acme - High Intent</a> shows 2.1x higher goal completion\",\"factors_insights_multiplier\":2.1,\"factors_insights_percentage\":4.5,\"factors_insights_users_count\":1422,\"factors_goal_users_count\":64,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Brand\",\"factors_insights_text\":\"and then <a>Acme - Brand</a> shows 2.4x higher goal completion\",\"factors_insights_multiplier\":2.4,\"factors_insights_percentage\":5.1,\"factors_insights_users_count\":1039,\"factors_goal_users_count\":53,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"Acme - Competitors\",\"factors_insights_text\":\"and then <a>Acme - Competitors</a> shows 4x higher goal completion\",\"factors_insights_multiplier\":4,\"factors_insights_percentage\":8.5,\"factors_insights_users_count\":905,\"factors_goal_users_count\":77,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\",\"factors_higher_completion_text\":\"higher completions for Acme - Retargeting +1factors\",\"factors_lower_completion_text\":\"lower completions for Acme - Retargeting\",\"factors_sub_insights\":[{\"factors_insights_key\":\"Acme - Retargeting\",\"factors_insights_text\":\"and then <a>Acme - Retargeting</a> shows 5.1x higher goal completion\",\"factors_insights_multiplier\":5.1,\"factors_insights_percentage\":10.8,\"factors_insights_users_count\":212,\"factors_goal_users_count\":23,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - High Intent\",\"factors_insights_text\":\"and then <a>Acme - High Intent</a> shows 4.7x higher goal completion\",\"factors_insights_multiplier\":4.7,\"factors_insights_percentage\":10,\"factors_insights_users_count\":180,\"factors_goal_users_count\":18,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"campaign\"},{\"factors_insights_key\":\"Acme - Lost Prospects\",\"factors_insights_text\":\"and then <a>Acme - Lost Prospects</a> shows 0.4x higher goal completion\",\"factors_insights_multiplier\":0.4,\"factors_insights_percentage\":0.8,\"factors_insights_users_count\":375,\"factors_goal_users_count\":3,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"campaign\"}]}]},{\"factors_insights_key\":\"www.acme.com\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com</a> shows 1.26x higher goal completion\",\"factors_insights_multiplier\":1.26,\"factors_insights_percentage\":2.7,\"factors_insights_users_count\":61000,\"factors_goal_users_count\":1647,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/pricing\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/pricing</a> shows 2.2x higher goal completion\",\"factors_insights_multiplier\":2.2,\"factors_insights_percentage\":4.7,\"factors_insights_users_count\":13531,\"factors_goal_users_count\":636,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/customers\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/customers</a> shows 5.4x higher goal completion\",\"factors_insights_multiplier\":5.4,\"factors_insights_percentage\":11.4,\"factors_insights_users_count\":2096,\"factors_goal_users_count\":239,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/integrations\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/integrations</a> shows 6.57x higher goal completion\",\"factors_insights_multiplier\":6.57,\"factors_insights_percentage\":13.9,\"factors_insights_users_count\":669,\"factors_goal_users_count\":93,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/product\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/product</a> shows 1.6x higher goal completion\",\"factors_insights_multiplier\":1.6,\"factors_insights_percentage\":3.4,\"factors_insights_users_count\":17147,\"factors_goal_users_count\":583,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"higher completions for www.acme.com/pricing +4factors\",\"factors_lower_completion_text\":\"lower completions for www.acme.com/pricing\",\"factors_sub_insights\":[{\"factors_insights_key\":\"www.acme.com/pricing\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/pricing</a> shows 3.4x higher goal completion\",\"factors_insights_multiplier\":3.4,\"factors_insights_percentage\":7.2,\"factors_insights_users_count\":1722,\"factors_goal_users_count\":124,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/company\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/company</a> shows 1.3x higher goal completion\",\"factors_insights_multiplier\":1.3,\"factors_insights_percentage\":2.8,\"factors_insights_users_count\":2000,\"factors_goal_users_count\":56,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/integrations\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/integrations</a> shows 8.7x higher goal completion\",\"factors_insights_multiplier\":8.7,\"factors_insights_percentage\":18.4,\"factors_insights_users_count\":255,\"factors_goal_users_count\":47,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/resources\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/resources</a> shows 1.4x higher goal completion\",\"factors_insights_multiplier\":1.4,\"factors_insights_percentage\":3,\"factors_insights_users_count\":566,\"factors_goal_users_count\":17,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Page_spent_time\",\"factors_attribute_value\":\"<=5sec\"}],\"factors_insights_text\":\"where <a>Page_spent_time<=5sec</a> shows 1.1x higher goal completion\",\"factors_insights_multiplier\":1.1,\"factors_insights_percentage\":2.3,\"factors_insights_users_count\":2043,\"factors_goal_users_count\":47,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Page_load_time\",\"factors_attribute_value\":\">=3sec\"}],\"factors_insights_text\":\"where <a>Page_load_time>=3sec</a> shows 0.6x higher goal completion\",\"factors_insights_multiplier\":0.6,\"factors_insights_percentage\":1.3,\"factors_insights_users_count\":1769,\"factors_goal_users_count\":23,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"}]},{\"factors_insights_key\":\"www.acme.com/solutions\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/solutions</a> shows 1.4x higher goal completion\",\"factors_insights_multiplier\":1.4,\"factors_insights_percentage\":3,\"factors_insights_users_count\":28266,\"factors_goal_users_count\":848,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"higher completions for www.acme.com/product +3factors\",\"factors_lower_completion_text\":\"lower completions for www.acme.com/product\",\"factors_sub_insights\":[{\"factors_insights_key\":\"www.acme.com/product\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/product</a> shows 2.4x higher goal completion\",\"factors_insights_multiplier\":2.4,\"factors_insights_percentage\":5.1,\"factors_insights_users_count\":3862,\"factors_goal_users_count\":197,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/solutions/finance\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/solutions/finance</a> shows 2.1x higher goal completion\",\"factors_insights_multiplier\":2.1,\"factors_insights_percentage\":4.5,\"factors_insights_users_count\":3844,\"factors_goal_users_count\":173,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/solutions/sales\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/solutions/sales</a> shows 1.2x higher goal completion\",\"factors_insights_multiplier\":1.2,\"factors_insights_percentage\":2.5,\"factors_insights_users_count\":18280,\"factors_goal_users_count\":457,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/customers\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/customers</a> shows 4.1x higher goal completion\",\"factors_insights_multiplier\":4.1,\"factors_insights_percentage\":8.7,\"factors_insights_users_count\":770,\"factors_goal_users_count\":67,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Vertical_Scroll \",\"factors_attribute_value\":\"<=10pct\"}],\"factors_insights_text\":\"where <a>Vertical_Scroll <=10pct</a> shows 0.8x higher goal completion\",\"factors_insights_multiplier\":0.8,\"factors_insights_percentage\":1.7,\"factors_insights_users_count\":1705,\"factors_goal_users_count\":29,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"}]},{\"factors_insights_key\":\"www.acme.com/documentation\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/documentation</a> shows 7.1x higher goal completion\",\"factors_insights_multiplier\":7.1,\"factors_insights_percentage\":15.1,\"factors_insights_users_count\":437,\"factors_goal_users_count\":66,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/resources\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/resources</a> shows 1.3x higher goal completion\",\"factors_insights_multiplier\":1.3,\"factors_insights_percentage\":2.8,\"factors_insights_users_count\":6642,\"factors_goal_users_count\":186,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_key\":\"www.acme.com/compliance\",\"factors_insights_text\":\"of which visitors coming via <a>www.acme.com/compliance</a> shows 8.2x higher goal completion\",\"factors_insights_multiplier\":8.2,\"factors_insights_percentage\":17.4,\"factors_insights_users_count\":304,\"factors_goal_users_count\":53,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"journey\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Industry\",\"factors_attribute_value\":\" Diversified Financial Services\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Industry= Diversified Financial Services</a> shows 0.8x higher goal completion\",\"factors_insights_multiplier\":0.8,\"factors_insights_percentage\":1.7,\"factors_insights_users_count\":14529,\"factors_goal_users_count\":247,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Industry\",\"factors_attribute_value\":\" Health Care Providers & Services\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Industry= Health Care Providers & Services</a> shows 0.5x higher goal completion\",\"factors_insights_multiplier\":0.5,\"factors_insights_percentage\":1.1,\"factors_insights_users_count\":10636,\"factors_goal_users_count\":117,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\" <5 mn\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Revenue <5 mn</a> shows 1.8x higher goal completion\",\"factors_insights_multiplier\":1.8,\"factors_insights_percentage\":3.8,\"factors_insights_users_count\":13526,\"factors_goal_users_count\":514,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\" 6-15 mn\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Revenue= 6-15 mn</a> shows 2.4x higher goal completion\",\"factors_insights_multiplier\":2.4,\"factors_insights_percentage\":5.1,\"factors_insights_users_count\":8666,\"factors_goal_users_count\":442,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\" 50mn+\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Revenue= 50mn+</a> shows 0.6x higher goal completion\",\"factors_insights_multiplier\":0.6,\"factors_insights_percentage\":1.3,\"factors_insights_users_count\":9923,\"factors_goal_users_count\":129,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Num_contacts_in_company\",\"factors_attribute_value\":\"6 to 10\"}],\"factors_insights_text\":\"of which visitors with <a>Num_contacts_in_company=6 to 10</a> shows 2.1x higher goal completion\",\"factors_insights_multiplier\":2.1,\"factors_insights_percentage\":4.5,\"factors_insights_users_count\":7577,\"factors_goal_users_count\":341,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Num_Sessions\",\"factors_attribute_value\":\" <3\"}],\"factors_insights_text\":\"of which visitors with <a>Num_Sessions <3</a> shows 0.7x higher goal completion\",\"factors_insights_multiplier\":0.7,\"factors_insights_percentage\":1.5,\"factors_insights_users_count\":28800,\"factors_goal_users_count\":432,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Industry\",\"factors_attribute_value\":\" Education Services\"}],\"factors_insights_text\":\"of which visitors with <a>Company_Industry= Education Services</a> shows 2.4x higher goal completion\",\"factors_insights_multiplier\":2.4,\"factors_insights_percentage\":5.1,\"factors_insights_users_count\":9372,\"factors_goal_users_count\":478,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"higher completions for Designation=Director +2factors\",\"factors_lower_completion_text\":\"lower completions for Designation=Director\",\"factors_sub_insights\":[{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Designation\",\"factors_attribute_value\":\"Director\"}],\"factors_insights_text\":\"where <a>Designation=Director</a> shows 3.1x higher goal completion\",\"factors_insights_multiplier\":3.1,\"factors_insights_percentage\":6.6,\"factors_insights_users_count\":1909,\"factors_goal_users_count\":126,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Company_Revenue\",\"factors_attribute_value\":\"50mn+\"}],\"factors_insights_text\":\"where <a>Company_Revenue=50mn+</a> shows 0.4x higher goal completion\",\"factors_insights_multiplier\":0.4,\"factors_insights_percentage\":0.8,\"factors_insights_users_count\":1750,\"factors_goal_users_count\":14,\"factors_multiplier_increase_flag\":false,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Num_contacts_in_company\",\"factors_attribute_value\":\"<=3\"}],\"factors_insights_text\":\"where <a>Num_contacts_in_company<=3</a> shows 1.7x higher goal completion\",\"factors_insights_multiplier\":1.7,\"factors_insights_percentage\":3.6,\"factors_insights_users_count\":7305,\"factors_goal_users_count\":263,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"},{\"factors_insights_attribute\":[{\"factors_attribute_key\":\"Country\",\"factors_attribute_value\":\"USA\"}],\"factors_insights_text\":\"where <a>Country=USA</a> shows 1.6x higher goal completion\",\"factors_insights_multiplier\":1.6,\"factors_insights_percentage\":3.4,\"factors_insights_users_count\":1264,\"factors_goal_users_count\":43,\"factors_multiplier_increase_flag\":true,\"factors_insights_type\":\"attribute\",\"factors_higher_completion_text\":\"\",\"factors_lower_completion_text\":\"\"}]}]}"
	}
	fac := Factors{}
	if err := json.Unmarshal([]byte(factorsOutput), &fac); err != nil {
		return
	}

	projectID := U.GetScopeByKeyAsUint64(c, mid.SCOPE_PROJECT_ID)
	if projectID == 0 {
		c.AbortWithStatus(http.StatusBadRequest)
		return
	}
	c.JSON(http.StatusOK, fac)
}
